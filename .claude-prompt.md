# TRAILERPHIM - AUTO POST MOVIES

Khi user yeu cau them phim/trailer, tu dong lam quy trình sau:

## WORKFLOW
1. Search TMDB theo tên phim (tieng Anh hoac tieng Viet)
2. Fetch movie details (credits, videos, images)
3. Viet SEO content (content, notable_points, faq)
4. Luu vao database (Movie + Trailers + Categories + Streamings)
5. Set published_at = now() de hien thi
6. Return link admin de confirm

## DATABASE SCHEMA

### Movies Table
```
- id (auto increment)
- title              // Tieu de tieng Viet
- original_title     // Tieu de goc (tieng Anh/dia ngu)
- slug               // URL slug (tu title, lowercase, dau gach noi)
- description        // Mo ta ngan (1-2 cau)
- content            // Noi dung SEO 120-180 chu
- notable_points     // Diem noi bat 2-3 cau
- faq                // JSON array [{q, a}, ...]
- poster             // URL anh poster (TMDB hoac local)
- backdrop           // URL anh background (cho slider)
- release_date       // Ngay phat hanh YYYY-MM-DD
- status             // ENUM: 'hot', 'upcoming', 'released'
- country            // Ten quoc gia (text field)
- director           // Ten dao dien
- cast               // Danh sach dien vien (text)
- duration           // Thoi luong (phut)
- view_count         // So luot xem (default 0)
- published_at       // Timestamp publish (BAT BUOC de hien thi)
- created_at, updated_at
```

### Trailers Table
```
- id
- movie_id           // Foreign key movies.id
- title              // Tieu de trailer
- slug               // URL slug
- youtube_id         // YouTube ID (11 ky tu)
- thumbnail          // Anh thumbnail YouTube (optional)
- is_main            // Boolean (true = trailer chinh)
- sort               // Thu tu hien thi (default 0)
- published_at       // Timestamp publish
```

### Categories Table (Polymorphic: genre, country, year)
```
- id
- name               // Ten tieng Viet
- slug               // URL slug
- type               // ENUM: 'genre', 'country', 'year'
- description        // Mo ta (optional)
```

### Streamings Table (Cinemas + Platforms)
```
- id
- name               // Ten (CGV, Netflix, Disney+...)
- slug               // URL slug
- type               // 'cinema' hoac 'streaming'
- icon               // SVG icon hoac Heroicon name
- url                // Link external (optional)
- is_active          // Boolean (default true)
- sort_order         // Thu tu sap xep
```

### Pivot Tables
- category_movie (movie_id, category_id) - Many-to-Many
- movie_streaming (id, movie_id, streaming_id, status, available_date, external_url)

## CATEGORIES DA CO

### Genres (14) - type='genre'
```
hanh-dong (Hanh dong)
kinh-di (Kinh di)
hai-huoc (Hai huoc)
tinh-cam (Tinh cam)
vien-tuong (Vien tuong)
hoat-hinh (Hoat hinh)
phieu-luu (Phieu luu)
toi-pham (Toi pham)
gia-dinh (Gia dinh)
bi-an (Bi an)
chien-tranh (Chien tranh)
kich-tinh (Kich tinh)
tai-lieu (Tai lieu)
the-thao (The thao)
```

### Countries (14) - type='country'
```
viet-nam (Viet Nam)
han-quoc (Han Quoc)
my (My)
trung-quoc (Trung Quoc)
nhat-ban (Nhat Ban)
thai-lan (Thai Lan)
anh (Anh)
phap (Phap)
duc (Duc)
uc (Uc)
canada (Canada)
an-do (An Do)
indonesia (Indonesia)
philippines (Philippines)
```

### Years (12) - type='year'
```
2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025, 2026, 2027
```

### Streamings (10)
```
Cinemas: CGV, Lotte, Galaxy, Beta, Cinestar
Streaming: Netflix, Disney+, HBO Go, Prime Video, Apple TV+
```

## MOVIE STATUS RULES

- `hot` - Phim HOT, duoc quan tam nhieu (released + trending)
- `upcoming` - Phim sap chieu (release_date trong tuong lai)
- `released` - Phim da cong chieu (mac dinh)

**Luu y**: Phim chi hien thi khi `published_at` IS NOT NULL va `published_at <= now()`

## TMDB API

```
Base URL: https://api.themoviedb.org/3
API Key: Lay tu .env (TMDB_API_KEY)

Endpoints:
- /search/movie?query={name}&api_key={key}
- /movie/{id}?api_key={key}&append_to_response=credits,videos,images
- /movie/{id}/videos  - Lay YouTube trailers
- /movie/{id}/credits - Lay cast, crew
- /movie/{id}/images  - Lay posters, backdrops
```

## SLUG GENERATION RULES

1. Tu tieng Viet co dau -> tieng Viet khong dau
2. Chuyen thanh lowercase
3. Thay khoang trang bang dau gach noi `-`
4. Xoa ky tu dac biet (tru a-z, 0-9, `-`)
5. Khong co dau gach noi o dau/cuoi
6. Khong co dau gach noi lien tiep `--`

Vi du: `Avatar: Lua va Tro Tan` -> `avatar-lua-va-vo-tan`

## SEO CONTENT TEMPLATE

### Content (120-180 chu)
- Mo dau: Gioi thieu boi canh phim
- Giua: Nhan vat chinh + xung dot chinh
- Ket: Ly do nen xem trailer
- **KHONG spoil** ket thuc hoac twist quan trong
- Dung tu ngu trung lap, khong quang cao qua da

### Notable Points (2-3 cau)
- Ly do phim duoc quan tam (sequel, franchise, dien vien noi tieng)
- Diem khac biet so voi phim cung the loai
- Thanh tich hoac ky luc (neu co)

### FAQ (3-5 cau Q&A)
Format JSON:
```json
[
  {"q": "Phim [Ten phim] khi nao chieu?", "a": "Phim du kien khoi chieu vao [ngay] tai [rap/platform]."},
  {"q": "Trailer [Ten phim] da ra chua?", "a": "Vao [ngay], nha san xuat da tung trailer chinh thuc..."},
  {"q": "[Ten phim] thuoc the loai gi?", "a": "Phim thuoc the loai [genre], ket hop yeu to [genre khac]."},
  {"q": "[Ten phim] co phu hop tre em khong?", "a": "Phim duoc phan loai [rating]..."},
  {"q": "Dao dien cua [Ten phim] la ai?", "a": "Phim do dao dien [ten] chiu trach nhiem chi dao..."}
]
```

## SEO URL STRUCTURE

```
Movie detail:     /phim/{slug}
Genre:            /the-loai/{slug}
Country:          /quoc-gia/{slug}
Year:             /nam-pham/{slug}
Hot movies:       /phim-hot
Upcoming:         /phim-sap-chieu
Released:         /phim-dang-chieu
Top viewed:       /top-phim
```

## RULES QUAN TRONG

1. **Moi phim viet HOAN TOAN MOI**, KHONG copy tu phim khac
2. **KHONG spoil** ket thuc, plot twist, cai ket
3. **KHONG nhac**: "xem full", "tai phim", "download", "phim le", "phim bo"
4. **Tieng Viet chuan**, giong trung lap, van phong bao chi
5. **Published_at**: BAT BUOC set `published_at = now()` de phim hien thi
6. **Slug**: Phai unique, kiem tra trung lap truoc khi insert
7. **Poster/Backdrop**: uu tien URL tu TMDB (duong dan full https://image.tmdb.org/...)
8. **Trailer**: is_main = true cho trailer chinh thuc, trailer khac de false
9. **Categories**: Link phim voi it nhat 1 genre, 1 country, 1 year

## SAVE TO DATABASE FORMAT

```php
// Tao Movie
$movie = Movie::create([
    'title' => 'Tieu de tieng Viet',
    'original_title' => 'Original Title',
    'slug' => 'slug-generate-tu-title',
    'description' => 'Mo ta ngan 1-2 cau',
    'content' => 'Noi dung SEO 120-180 chu...',
    'notable_points' => 'Diem noi bat 2-3 cau...',
    'faq' => json_encode([...]),
    'poster' => 'https://image.tmdb.org/...',
    'backdrop' => 'https://image.tmdb.org/...',
    'release_date' => '2026-05-15',
    'status' => 'upcoming', // hoac 'hot', 'released'
    'country' => 'My',
    'director' => 'Ten dao dien',
    'cast' => 'Dien vien 1, Dien vien 2, ...',
    'duration' => 120, // phut
    'published_at' => now(),
]);

// Tao Trailers
Trailer::create([
    'movie_id' => $movie->id,
    'title' => 'Official Trailer',
    'slug' => 'official-trailer',
    'youtube_id' => 'abc12345678',
    'is_main' => true,
    'sort' => 1,
    'published_at' => now(),
]);

// Link Categories
$movie->categories()->attach([$genreId, $countryId, $yearId]);
```
